html
    include include/html_head.pug
    body
        include include/head.pug

        form(method='POST', action='/plans/'+plan_id)    
            input(type='hidden', value='PUT', name='_method')
            table(class="plan")
                tr(class="header")
                    td(class="header_void")
                    td(class="header_account")

                    th JAN
                    th FEB
                    th MAR
                    th APR
                    th MAY
                    th JUN
                    th JUL
                    th AUG
                    th SEP
                    th OCT
                    th NOV
                    th DEC

                each val in data
                    if val['level']==1
                        tr(class="space")
                            th
                            td(colspan=13)
                    
                    tr(class='level'+val['level']+' row', data-parent=val['level']==5 ? val['parent_id'] : false)
                    
                        if val['level']==0
                            th(colspan="2")
                                input(type="button" onclick="location.reload()", value="refresh") 
                                =val['name']
                        else if val['level']==3
                            th(class="void")
                            th(class="account" id="account_"+val['id'])
                                div
                                    a(onclick='show_hide('+val['id']+',this)', data-is_open="0" href="#")='[+]'
                                    =' '+val['name']
                        else
                            th(class="void")
                            th(class="account")
                                div=val['name']
                            
                        if val['level']!=5
                            td=val['JAN']!==null ? Math.round(val['JAN']) : 0                       
                            td=val['FEB']!==null ? Math.round(val['FEB']) : 0 
                            td=val['MAR']!==null ? Math.round(val['MAR']) : 0 
                            td=val['APR']!==null ? Math.round(val['APR']) : 0 
                            td=val['MAY']!==null ? Math.round(val['MAY']) : 0 
                            td=val['JUN']!==null ? Math.round(val['JUN']) : 0 
                            td=val['JUL']!==null ? Math.round(val['JUL']) : 0 
                            td=val['AUG']!==null ? Math.round(val['AUG']) : 0 
                            td=val['SEP']!==null ? Math.round(val['SEP']) : 0 
                            td=val['OCT']!==null ? Math.round(val['OCT']) : 0 
                            td=val['NOV']!==null ? Math.round(val['NOV']) : 0 
                            td=val['DEC']!==null ? Math.round(val['DEC']) : 0 
                        else 
                            td
                                input(value=val['JAN'], type='text', name=val['id']+';JAN',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';JAN'+"')")
                            td
                                input(value=val['FEB'], type='text', name=val['id']+';FEB',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';FEB'+"')")
                            td
                                input(value=val['MAR'], type='text', name=val['id']+';MAR',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';MAR'+"')")
                            td
                                input(value=val['APR'], type='text', name=val['id']+';APR',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';APR'+"')")
                            td
                                input(value=val['MAY'], type='text', name=val['id']+';MAY',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';MAY'+"')")
                            td
                                input(value=val['JUN'], type='text', name=val['id']+';JUN',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';JUN'+"')")
                            td
                                input(value=val['JUL'], type='text', name=val['id']+';JUL',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';JUL'+"')")
                            td
                                input(value=val['AUG'], type='text', name=val['id']+';AUG',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';AUG'+"')")
                            td
                                input(value=val['SEP'], type='text', name=val['id']+';SEP',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';SEP'+"')")
                            td
                                input(value=val['OCT'], type='text', name=val['id']+';OCT',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';OCT'+"')")
                            td
                                input(value=val['NOV'], type='text', name=val['id']+';NOV',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';NOV'+"')")
                            td
                                input(value=val['DEC'], type='text', name=val['id']+';DEC',disabled=disable_form, class="value_input", onchange="save_value(this,"+plan_id+",'"+val['id']+';DEC'+"')")
                tr(class="space")
                    th
                    td(colspan=13)

        script.
        
        
            function save_value(x,plan_id,name)
            {
                var t = name.split(";")
                $.ajax(
                {
                  url: '/plans',
                  data: JSON.stringify({"plan_id":plan_id,"month":t[1],"key":t[0],"value":x.value}),
                  method:"PUT",
                  contentType: "application/json"

                }).done(function(d)
                {
                    $(x).removeClass("error")
                }).fail(function(r)
                {
                    $(x).addClass("error")
                });
            }
        
            function show_hide(o,t)
            {
                t.dataset['is_open'] = t.dataset['is_open'] === "0" ? "1" : "0"
                if(t.dataset['is_open']==="0") t.innerHTML = '[+]';
                else t.innerHTML = '[-]';
                var tr = document.getElementsByTagName('tr');

                for(var i = 0; i < tr.length; i++)
                {
                    if(tr[i].dataset['parent'] == o)
                    {
                        tr[i].style.display = t.dataset['is_open']==="0" ? 'none' : 'table-row';
                    }
                }
                
                var v = $(t).parent().parent().attr('id')
                
                setTimeout(function()
                {
                    location.href = "#"
                    location.href = "#"+v
                },100)
            }
                        